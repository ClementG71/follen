---
// MiniCarousel.astro - Version réduite du carrousel pour page secteur

interface Slide {
    id: number;
    title: string;
    excerpt: string;
    image: string;
    href: string;
    category?: string;
}

interface Props {
    articles: Slide[];
}

const { articles } = Astro.props;
---

<section class="relative w-full h-[300px] md:h-[400px] overflow-hidden bg-slate-900">
    <!-- Scroll Container -->
    <div class="scroll-container h-full flex overflow-x-auto snap-x snap-mandatory scrollbar-hide">
        {articles.map((article, index) => (
            <div 
                class="carousel-slide flex-shrink-0 w-full h-full snap-start relative"
                data-index={index}
            >
                <!-- Image Background -->
                <img 
                    src={article.image} 
                    alt={article.title}
                    class="absolute inset-0 w-full h-full object-cover"
                    loading={index === 0 ? 'eager' : 'lazy'}
                />
                
                <!-- Overlay Gradient -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
                
                <!-- Content Overlay -->
                <div class="absolute bottom-0 left-0 right-0 p-6 md:p-12 z-10 max-w-3xl">
                    {article.category && (
                        <span class="inline-block text-xs font-semibold uppercase tracking-widest text-blue-400 mb-3">
                            {article.category}
                        </span>
                    )}
                    <h2 class="text-2xl md:text-3xl font-bold text-white mb-3 leading-tight">
                        {article.title}
                    </h2>
                    <p class="text-base md:text-lg text-blue-100 mb-4 max-w-xl line-clamp-2">
                        {article.excerpt}
                    </p>
                    <a 
                        href={article.href}
                        class="inline-flex items-center bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors text-sm"
                    >
                        Lire l'article
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                        </svg>
                    </a>
                </div>
            </div>
        ))}
    </div>

    <!-- Scroll Indicators -->
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 z-20 flex gap-2">
        {articles.map((_, index) => (
            <button 
                class="carousel-dot w-2.5 h-2.5 rounded-full bg-white/50 hover:bg-white transition-colors"
                data-index={index}
                aria-label={`Aller au slide ${index + 1}`}
            ></button>
        ))}
    </div>

    <!-- Navigation Arrows -->
    <button 
        class="carousel-prev absolute left-2 top-1/2 -translate-y-1/2 z-20 p-2 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/40 transition-colors"
        aria-label="Slide précédent"
    >
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
    </button>
    <button 
        class="carousel-next absolute right-2 top-1/2 -translate-y-1/2 z-20 p-2 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/40 transition-colors"
        aria-label="Slide suivant"
    >
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
    </button>
</section>

<script>
    // Navigation simple avec les dots et les flèches (même logique que ScrollSnapCarousel)
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('.scroll-container');
        const dots = document.querySelectorAll('.carousel-dot');
        const prevBtn = document.querySelector('.carousel-prev');
        const nextBtn = document.querySelector('.carousel-next');
        const slides = document.querySelectorAll('.carousel-slide');
        
        if (!container || slides.length === 0) return;

        function updateDots() {
            const scrollLeft = container.scrollLeft;
            const slideWidth = container.clientWidth;
            const currentIndex = Math.round(scrollLeft / slideWidth);
            
            dots.forEach((dot, index) => {
                if (index === currentIndex) {
                    dot.classList.remove('bg-white/50');
                    dot.classList.add('bg-white');
                } else {
                    dot.classList.remove('bg-white');
                    dot.classList.add('bg-white/50');
                }
            });
        }

        function goToSlide(index) {
            const slideWidth = container.clientWidth;
            container.scrollTo({
                left: slideWidth * index,
                behavior: 'smooth'
            });
        }

        container.addEventListener('scroll', updateDots);
        
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => goToSlide(index));
        });

        prevBtn?.addEventListener('click', () => {
            const currentIndex = Math.round(container.scrollLeft / container.clientWidth);
            goToSlide(currentIndex > 0 ? currentIndex - 1 : slides.length - 1);
        });

        nextBtn?.addEventListener('click', () => {
            const currentIndex = Math.round(container.scrollLeft / container.clientWidth);
            goToSlide(currentIndex < slides.length - 1 ? currentIndex + 1 : 0);
        });

        updateDots();
    });
</script>

<style>
    .scroll-container {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .scroll-container::-webkit-scrollbar {
        display: none;
    }
    
    .scrollbar-hide {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

