---
// ScrollSnapCarousel.astro - Carrousel Hero avec CSS Scroll Snap

interface Slide {
    id: number;
    title: string;
    excerpt: string;
    image: string;
    href: string;
    category?: string;
}

interface Props {
    articles: Slide[];
}

const { articles } = Astro.props;
---

<div class="bg-slate-50 py-8">
    <div class="container mx-auto px-4 md:px-6">
        <section class="relative w-full h-[500px] md:h-[600px] rounded-2xl overflow-hidden shadow-2xl bg-slate-900">
            <!-- Scroll Container -->
            <div class="scroll-container h-full flex overflow-x-auto snap-x snap-mandatory scrollbar-hide">
                {articles.map((article, index) => (
                    <div 
                        class="carousel-slide flex-shrink-0 w-full h-full snap-start relative"
                        data-index={index}
                    >
                        <!-- Image Background -->
                        <img 
                            src={article.image} 
                            alt={article.title}
                            class="absolute inset-0 w-full h-full object-cover"
                            loading={index === 0 ? 'eager' : 'lazy'}
                        />
                        
                        <!-- Overlay léger -->
                        <div class="absolute inset-0 bg-black/10"></div>
                        
                        <!-- Bloc Contenu type "Carte blanche" -->
                        <div class="absolute bottom-0 left-0 w-full md:w-auto md:max-w-3xl p-6 md:p-10">
                            <div class="bg-white/95 backdrop-blur-md p-8 rounded-xl shadow-lg transform transition-transform duration-500 hover:-translate-y-1">
                                {article.category && (
                                    <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 text-xs font-bold uppercase tracking-widest rounded-full mb-3">
                                        {article.category}
                                    </span>
                                )}
                                <h2 class="text-2xl md:text-3xl font-bold text-slate-900 mb-3 leading-tight">
                                    {article.title}
                                </h2>
                                <p class="text-base md:text-lg text-slate-600 mb-5 leading-relaxed line-clamp-2">
                                    {article.excerpt}
                                </p>
                                <a 
                                    href={article.href}
                                    class="inline-flex items-center text-blue-700 font-bold hover:text-blue-900 transition-colors group text-sm md:text-base"
                                >
                                    Lire l'article
                                    <svg class="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                ))}
            </div>

            <!-- Scroll Indicators -->
            <div class="absolute bottom-6 right-6 z-20 flex gap-2">
                {articles.map((_, index) => (
                    <button 
                        class="carousel-dot w-2.5 h-2.5 rounded-full bg-white/50 hover:bg-white transition-colors shadow-sm"
                        data-index={index}
                        aria-label={`Aller au slide ${index + 1}`}
                    ></button>
                ))}
            </div>

            <!-- Navigation Arrows -->
            <button 
                class="carousel-prev absolute left-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/40 transition-colors hidden md:block shadow-lg"
                aria-label="Slide précédent"
            >
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button 
                class="carousel-next absolute right-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/40 transition-colors hidden md:block shadow-lg"
                aria-label="Slide suivant"
            >
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </section>
    </div>
</div>

<script>
    // Navigation simple avec les dots et les flèches
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('.scroll-container');
        const dots = document.querySelectorAll('.carousel-dot');
        const prevBtn = document.querySelector('.carousel-prev');
        const nextBtn = document.querySelector('.carousel-next');
        const slides = document.querySelectorAll('.carousel-slide');
        
        if (!container || slides.length === 0) return;

        function updateDots() {
            const scrollLeft = container.scrollLeft;
            const slideWidth = container.clientWidth;
            const currentIndex = Math.round(scrollLeft / slideWidth);
            
            dots.forEach((dot, index) => {
                if (index === currentIndex) {
                    dot.classList.remove('bg-white/50');
                    dot.classList.add('bg-white');
                } else {
                    dot.classList.remove('bg-white');
                    dot.classList.add('bg-white/50');
                }
            });
        }

        function goToSlide(index) {
            const slideWidth = container.clientWidth;
            container.scrollTo({
                left: slideWidth * index,
                behavior: 'smooth'
            });
        }

        // Event listeners
        container.addEventListener('scroll', updateDots);
        
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => goToSlide(index));
        });

        prevBtn?.addEventListener('click', () => {
            const currentIndex = Math.round(container.scrollLeft / container.clientWidth);
            goToSlide(currentIndex > 0 ? currentIndex - 1 : slides.length - 1);
        });

        nextBtn?.addEventListener('click', () => {
            const currentIndex = Math.round(container.scrollLeft / container.clientWidth);
            goToSlide(currentIndex < slides.length - 1 ? currentIndex + 1 : 0);
        });

        // Initial dot state
        updateDots();
    });
</script>

<style>
    .scroll-container {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .scroll-container::-webkit-scrollbar {
        display: none;
    }
    
    .scrollbar-hide {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
