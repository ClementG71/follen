---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/Navbar.astro';
import HeroCarousel from '../components/HeroCarousel.astro';
import ActionCardsSection from '../components/ActionCardsSection.astro';
import { getHomePage, getBlogPosts } from '../lib/wagtail';

// Récupération des données Wagtail
const homepage = await getHomePage();
const blogPosts = await getBlogPosts(3);

const title = homepage?.hero_title || 'Accueil Follen';

// Données mock pour le carrousel (à remplacer par des vraies données Wagtail plus tard)
const mockCarouselSlides = [
    {
        title: "L'agriculture régénératrice : l'avenir de nos sols",
        image_url: "https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=1920&q=80",
        link: "/articles/agriculture-regeneratrice",
        category: "Agriculture"
    },
    {
        title: "Créer un intérieur éco-responsable et design",
        image_url: "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=1920&q=80",
        link: "/articles/interieur-eco-responsable",
        category: "Intérieur"
    },
    {
        title: "Les gestes simples pour réduire son empreinte carbone",
        image_url: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&q=80",
        link: "/articles/reduire-empreinte-carbone",
        category: "Écologie"
    },
    {
        title: "Permaculture : transformer son jardin en écosystème",
        image_url: "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=1920&q=80",
        link: "/articles/permaculture-jardin",
        category: "Agriculture"
    }
];

// Utilise les vraies données si disponibles, sinon les mock
const carouselSlides = mockCarouselSlides; 
---

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Follen - Votre guide vers un mode de vie durable" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
</head>
<body class="font-sans bg-gray-50 min-h-screen">
    <!-- Navbar -->
    <Navbar currentPath="/" />

    <!-- Hero Carousel -->
    <HeroCarousel articles={carouselSlides} interval={5000} />

    <!-- Section Hero Wagtail (si données disponibles) -->
    {homepage?.hero_title && (
        <section class="py-16 bg-white">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
                    {homepage.hero_title}
                </h1>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-8">
                    {homepage.hero_subtitle}
                </p>
                
                {homepage.hero_cta_text && homepage.hero_cta_link && (
                    <a 
                        href={homepage.hero_cta_link} 
                        class="inline-block bg-emerald-600 text-white px-8 py-4 rounded-lg font-medium hover:bg-emerald-700 transition-colors shadow-lg hover:shadow-xl"
                    >
                        {homepage.hero_cta_text}
                    </a>
                )}
            </div>
        </section>
    )}

    <!-- Section Features (StreamField) -->
    {homepage?.features && homepage.features.length > 0 && (
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center text-gray-900 mb-12">Nos engagements</h2>
                <div class="grid md:grid-cols-3 gap-8">
                    {homepage.features.map((block) => (
                        <div class="bg-white p-8 rounded-2xl shadow-lg hover:shadow-xl transition-shadow">
                            {block.value.icon && (
                                <div class="w-14 h-14 bg-emerald-100 rounded-xl flex items-center justify-center mb-6">
                                    <span class="text-2xl">{block.value.icon}</span>
                                </div>
                            )}
                            <h3 class="text-xl font-semibold text-gray-900 mb-3">
                                {block.value.title}
                            </h3>
                            <p class="text-gray-600 leading-relaxed">
                                {block.value.description}
                            </p>
                        </div>
                    ))}
                </div>
            </div>
        </section>
    )}

    <!-- Section Actions (Nouveau composant) -->
    <ActionCardsSection />

    <!-- Section Articles -->
    <section class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900">Derniers articles</h2>
                <a href="/articles" class="text-emerald-600 font-medium hover:text-emerald-700 transition-colors flex items-center gap-2">
                    Voir tout
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </a>
            </div>
            
            {blogPosts.length > 0 ? (
                <div class="grid md:grid-cols-3 gap-8">
                    {blogPosts.map((post) => (
                        <article class="group bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
                            {post.header_image_thumbnail ? (
                                <div class="aspect-[16/10] overflow-hidden">
                                    <img 
                                        src={post.header_image_thumbnail} 
                                        alt={post.title} 
                                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                    />
                                </div>
                            ) : (
                                <div class="aspect-[16/10] bg-gradient-to-br from-emerald-400 to-teal-500"></div>
                            )}
                            <div class="p-6">
                                <p class="text-sm text-gray-500 mb-2">
                                    {new Date(post.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })}
                                </p>
                                <h3 class="text-xl font-semibold text-gray-900 mb-3 group-hover:text-emerald-600 transition-colors">
                                    {post.title}
                                </h3>
                                <p class="text-gray-600 mb-4 line-clamp-2">{post.introduction}</p>
                                <a 
                                    href={`/articles/${post.meta?.slug}`} 
                                    class="inline-flex items-center text-emerald-600 font-medium hover:gap-3 gap-2 transition-all"
                                >
                                    Lire la suite
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                    </svg>
                                </a>
                            </div>
                        </article>
                    ))}
                </div>
            ) : (
                <div class="text-center py-12 text-gray-500">
                    <p>Aucun article disponible pour le moment.</p>
                </div>
            )}
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center gap-2 mb-4 md:mb-0">
                    <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">F</span>
                    </div>
                    <span class="font-bold text-xl">Follen</span>
                </div>
                <p class="text-gray-400 text-sm">
                    &copy; {new Date().getFullYear()} Follen. Tous droits réservés.
                </p>
            </div>
        </div>
    </footer>
</body>
</html>

<style>
    /* Line clamp pour les textes tronqués */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
